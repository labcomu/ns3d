FROM ubuntu:noble

ARG DEBIAN_FRONTEND=noninteractive

RUN apt-get update; \
    apt upgrade --assume-yes --new-pkgs; \
    apt autoremove --assume-yes --purge; \
    apt clean;

RUN apt-get install --assume-yes \
    build-essential \
    ccache \
    cmake \
    curl \
    g++ \
    html-xml-utils \
    nano \
    python3 \
    python3-dev \
    python3-pip \
    qt5-qmake \
    qtbase5-dev \
    qtbase5-dev-tools \
    qtchooser \
    vim \
    ;

RUN pip3 install --upgrade --break-system-packages \
    cppyy \
    ;

RUN mkdir -p /app/; \
    chown -R 1001:1001 /app/

ENV PATH="/dist:/dist/ns3:$PATH" \
    CCACHE_DIR=/tmp \
    DISTDIR=/dist \
    NS3DIR=/dist/ns3 \
    NS3LOGDIR=/dist/log \
    NS3CONFIG="--enable-examples --enable-tests" \
    NS3DEBUG="--build-profile=debug --out=build/debug" \
    NS3OPT="--build-profile=optimized --out=build/optimized"

USER 1000

WORKDIR /dist/
    
COPY ns3-get.sh /tmp/
RUN bash /tmp/ns3-get.sh

COPY ns3-build.sh /tmp/
RUN bash /tmp/ns3-build.sh

COPY ns3-addon.sh /tmp/
RUN bash /tmp/ns3-addon.sh

COPY res/ns3/ /dist/ns3/

RUN echo 

WORKDIR /dist/ns3/
